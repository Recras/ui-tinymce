angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig","uiTinymceService",function(g,v,y,b,p,h,U){return(h=h||{}).baseUrl&&(tinymce.baseURL=h.baseUrl),{require:["ngModel","^?form"],priority:599,link:function(o,r,u,e){var t,n,i,c,a,s,d,m,f;function l(e){e?($(),a&&a.getBody().setAttribute("contenteditable",!1)):($(),a&&!a.options.get("readonly")&&a.getDoc()&&a.getBody().setAttribute("contenteditable",!0))}function $(){a=a||tinymce.get(u.id)}b.tinymce&&(t=e[0],n=e[1]||null,c={debounce:!0},s=function(e){e=e.getContent({format:c.format}).trim(),e=p.trustAsHtml(e);t.$setViewValue(e),g.$$phase||o.$digest()},u.id||(e=U.getUniqueId(),u.$set("id",e)),i={},angular.extend(i,o.$eval(u.uiTinymce)),d=function(t){y.cancel(m),m=y(function(){var e;(e=t).isDirty()&&(e.save(),s(e))},400)},e={setup:function(e){e.on("init",function(){t.$render(),t.$setPristine(),t.$setUntouched(),n&&n.$setPristine()}),e.on("ExecCommand change NodeChange ObjectResized",function(){c.debounce?d(e):e.isDirty()&&(e.save(),s(e))}),e.on("blur",function(){r[0].blur(),t.$setTouched(),g.$$phase||o.$digest()}),e.on("paste",function(){e.isNotDirty=!1}),e.on("remove",function(){r.remove()}),h.setup&&h.setup(e,{updateView:s}),i.setup&&i.setup(e,{updateView:s})},format:i.format||"html",branding:!1,selector:"#"+u.id},angular.extend(c,h,i,e),y(function(){c.baseURL&&(tinymce.baseURL=c.baseURL);var e=tinymce.init(c);e&&"function"==typeof e.then?e.then(function(){l(o.$eval(u.ngDisabled))}):l(o.$eval(u.ngDisabled))}),t.$formatters.unshift(function(e){return e?p.trustAsHtml(e):""}),t.$parsers.unshift(function(e){return e?p.getTrustedHtml(e):""}),t.$render=function(){$();var e=t.$viewValue?p.getTrustedHtml(t.$viewValue):"";a&&a.getDoc()&&(a.setContent(e),a.fire("change"))},u.$observe("disabled",l),f=o.$on("$tinymce:refresh",function(e,t){var n,i=u.id;!angular.isUndefined(t)&&t!==i||(t=r.parent(),(n=r.clone()).removeAttr("id"),n.removeAttr("style"),n.removeAttr("aria-hidden"),tinymce.execCommand("mceRemoveEditor",!1,i),t.append(v(n)(o)),f())}),o.$on("$destroy",function(){$(),a&&(a.remove(),a=null)}))}}}]).service("uiTinymceService",[function(){return new function(){var e=0;return{getUniqueId:function(){return"ui-tinymce-"+ ++e}}}}]);
