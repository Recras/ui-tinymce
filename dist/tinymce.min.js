angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig","uiTinymceService",function(e,t,n,i,r,u,o){u=u||{};if(u.baseUrl){tinymce.baseURL=u.baseUrl}return{require:["ngModel","^?form"],priority:599,link:function(a,c,f,s){if(!i.tinymce){return}var d=s[0],l=s[1]||null;var m,v={debounce:true},$,g=function(t){var n=t.getContent({format:v.format}).trim();n=r.trustAsHtml(n);d.$setViewValue(n);if(!e.$$phase){a.$digest()}};function y(e){if(e){T();if($){$.getBody().setAttribute("contenteditable",false)}}else{T();if($&&!$.settings.readonly&&$.getDoc()){$.getBody().setAttribute("contenteditable",true)}}}if(!f.id){var b=o.getUniqueId();f.$set("id",b)}m={};angular.extend(m,a.$eval(f.uiTinymce));var p=function(e){var t;return function(i){n.cancel(t);t=n(function(){return function(e){if(e.isDirty()){e.save();g(e)}}(i)},e)}}(400);var h={setup:function(t){t.on("init",function(){d.$render();d.$setPristine();d.$setUntouched();if(l){l.$setPristine()}});t.on("ExecCommand change NodeChange ObjectResized",function(){if(!v.debounce){t.save();g(t);return}p(t)});t.on("blur",function(){c[0].blur();d.$setTouched();if(!e.$$phase){a.$digest()}});t.on("paste",function(){t.isNotDirty=false});t.on("remove",function(){c.remove()});if(u.setup){u.setup(t,{updateView:g})}if(m.setup){m.setup(t,{updateView:g})}},format:m.format||"html",branding:false,selector:"#"+f.id};angular.extend(v,u,m,h);n(function(){if(v.baseURL){tinymce.baseURL=v.baseURL}var e=tinymce.init(v);if(e&&typeof e.then==="function"){e.then(function(){y(a.$eval(f.ngDisabled))})}else{y(a.$eval(f.ngDisabled))}});d.$formatters.unshift(function(e){return e?r.trustAsHtml(e):""});d.$parsers.unshift(function(e){return e?r.getTrustedHtml(e):""});d.$render=function(){T();var e=d.$viewValue?r.getTrustedHtml(d.$viewValue):"";if($&&$.getDoc()){$.setContent(e);$.fire("change")}};f.$observe("disabled",y);var U=a.$on("$tinymce:refresh",function(e,n){var i=f.id;if(angular.isUndefined(n)||n===i){var r=c.parent();var u=c.clone();u.removeAttr("id");u.removeAttr("style");u.removeAttr("aria-hidden");tinymce.execCommand("mceRemoveEditor",false,i);r.append(t(u)(a));U()}});a.$on("$destroy",function(){T();if($){$.remove();$=null}});function T(){if(!$){$=tinymce.get(f.id)}}}}}]).service("uiTinymceService",[function(){var e=function(){var e="ui-tinymce";var t=0;var n=function(){t++;return e+"-"+t};return{getUniqueId:n}};return new e}]);
